<!DOCTYPE html>
<html>
<head>
  <title>Radha Naam Bank</title>
  <meta charset="UTF-8">
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <style>
    body { 
      margin: 0; font-family: 'Georgia', serif; 
      background: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('https://images.unsplash.com/photo-1623910541743-40a768c6883a?q=80&w=2000&auto=format&fit=crop');
      background-size: cover; background-attachment: fixed; text-align: center; color: #4a2c2a; 
    }
    header { background: #800000; color: gold; padding: 15px; font-size: 28px; border-bottom: 4px solid #d4af37; box-shadow: 0 4px 10px rgba(0,0,0,0.5); }
    .card { background: rgba(255, 255, 255, 0.92); padding: 25px; margin: 15px auto; width: 360px; border-radius: 25px; box-shadow: 0 15px 35px rgba(0,0,0,0.3); }
    h2 { color: #800000; font-size: 45px; margin: 10px 0; }
    input { padding: 12px; margin: 10px 0; width: 85%; border-radius: 10px; border: 1px solid #dcc; font-size: 16px; }
    .btn-main { padding: 15px; background: #800000; color: gold; border: 2px solid gold; font-size: 18px; border-radius: 15px; cursor: pointer; width: 80%; font-weight: bold; }
    .tab-btn { padding: 8px 12px; background: #eee; border: none; cursor: pointer; margin: 5px; border-radius: 8px; font-weight: bold; font-size: 13px; }
    .tab-btn.active { background: #800000; color: white; }
    .controls { margin: 10px; font-size: 24px; }
    .control-icon { cursor: pointer; margin: 0 10px; opacity: 0.3; transition: 0.3s; }
    .control-icon.active { opacity: 1; filter: drop-shadow(0 0 5px gold); }
    .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; background: #fdf2d5; padding: 10px; border-radius: 15px; margin-top: 15px; border: 1px solid #e0c097; }
    .reset-btn { font-size: 11px; color: #800000; cursor: pointer; text-decoration: underline; background: none; border: none; }
    .hindi-display { font-size: 40px; color: #800000; height: 50px; display: block; }
  </style>
</head>
<body>

<header>ðŸŒ¸ Radha Naam Bank ðŸŒ¸</header>

<div id="authSection" class="card">
    <h3 id="authTitle">Devotee Login</h3>
    <input type="email" id="email" placeholder="Email Address">
    <input type="password" id="password" placeholder="Password">
    <button class="btn-main" style="background:#ff9933; border:none; color:white; width: 100%;" onclick="handleAuth()">Login</button>
    <p onclick="toggleAuth()" id="toggleLink" style="cursor:pointer; text-decoration:underline; font-size:14px; margin-top:15px;">New Devotee? Signup</p>
    <p onclick="forgotPassword()" style="cursor:pointer; color: #0000EE; font-size: 12px;">Forgot Password?</p>
</div>

<div id="bankSection" style="display:none;">
    <div class="card">
        <div class="controls">
            <span id="soundIcon" class="control-icon" onclick="toggleControl('sound')">ðŸ””</span>
            <span id="vibrateIcon" class="control-icon" onclick="toggleControl('vibrate')">ðŸ“±</span>
        </div>

        <div id="tabs">
            <button class="tab-btn active" id="btnTab" onclick="showMode('click')">Jaap (Click)</button>
            <button class="tab-btn" id="writeTab" onclick="showMode('write')">Likhit (Type)</button>
        </div>

        <div id="clickMode">
            <h2>à¤°à¤¾à¤§à¤¾</h2>
            <button class="btn-main" onclick="addCount('jaap')">Click for Radha naam</button>
            <div class="stats-grid">
                <div><small>Session</small><br><b id="sJaap">0</b></div>
                <div><small>Total</small><br><b id="uJaap">0</b></div>
            </div>
            <button class="reset-btn" onclick="resetSession('jaap')">Reset Session</button>
        </div>

        <div id="writeMode" style="display:none;">
            <span class="hindi-display" id="hindiText"></span>
            <input type="text" id="radhaInput" placeholder="Type 'Radha' & Enter" onkeypress="checkEnter(event)" style="text-align:center; font-size:20px;">
            <div class="stats-grid">
                <div><small>Session</small><br><b id="sWrite">0</b></div>
                <div><small>Total</small><br><b id="uWrite">0</b></div>
            </div>
            <button class="reset-btn" onclick="resetSession('write')">Reset Session</button>
        </div>
        
        <div style="margin-top:20px; font-size: 20px; color: #800000; font-weight: bold;">
            Global Total: <span id="gTotal">0</span>
        </div>
        <button onclick="logout()" style="margin-top:20px; border:none; background:none; color:gray; cursor:pointer; font-size: 12px;">Logout</button>
    </div>
</div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCjWR3iIF07Ohj22bjzv5QIPFKL55t1wB0",
    authDomain: "radha-naam-bank-abec4.firebaseapp.com",
    projectId: "radha-naam-bank-abec4",
    storageBucket: "radha-naam-bank-abec4.firebasestorage.app",
    messagingSenderId: "625272113751",
    appId: "1:625272113751:web:607d6c0544fbba4eb2f112"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  let session = { jaap: 0, write: 0 };
  let controls = { sound: false, vibrate: false };
  let isSignupMode = false;

  const bell = new Audio('https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3');

  function toggleControl(type) {
    controls[type] = !controls[type];
    document.getElementById(type + 'Icon').classList.toggle('active');
  }

  function toggleAuth() {
    isSignupMode = !isSignupMode;
    document.getElementById('authTitle').innerText = isSignupMode ? "Create Account" : "Devotee Login";
    document.getElementById('toggleLink').innerText = isSignupMode ? "Login instead" : "New Devotee? Signup";
  }

  function showMode(mode) {
    document.getElementById('clickMode').style.display = mode === 'click' ? 'block' : 'none';
    document.getElementById('writeMode').style.display = mode === 'write' ? 'block' : 'none';
    document.getElementById('btnTab').className = mode === 'click' ? 'tab-btn active' : 'tab-btn';
    document.getElementById('writeTab').className = mode === 'write' ? 'tab-btn active' : 'tab-btn';
  }

  function resetSession(type) {
    session[type] = 0;
    document.getElementById('s' + type.charAt(0).toUpperCase() + type.slice(1)).innerText = 0;
  }

  function checkEnter(e) {
    if(e.key === 'Enter') {
        const val = document.getElementById('radhaInput').value.toLowerCase().trim();
        if(val === 'radha') {
            document.getElementById('hindiText').innerText = "à¤°à¤¾à¤§à¤¾";
            document.getElementById('radhaInput').value = "";
            addCount('write');
            setTimeout(() => { document.getElementById('hindiText').innerText = ""; }, 700);
        } else { document.getElementById('radhaInput').value = ""; }
    }
  }

  async function addCount(type) {
    if (controls.sound) bell.play();
    if (controls.vibrate && navigator.vibrate) navigator.vibrate(100);

    session[type]++;
    const uid = auth.currentUser.uid;
    const uRef = db.collection("users").doc(uid);
    const gRef = db.collection("stats").doc("global");

    await db.runTransaction(async (t) => {
        const uDoc = await t.get(uRef);
        const gDoc = await t.get(gRef);
        let uData = uDoc.exists ? uDoc.data() : { jaap: 0, write: 0 };
        uData[type] = (uData[type] || 0) + 1;
        t.set(uRef, uData);
        t.set(gRef, { count: (gDoc.exists ? gDoc.data().count : 0) + 1 });
    });
    updateDisplay(uid);
  }

  async function updateDisplay(uid) {
    const uDoc = await db.collection("users").doc(uid).get();
    const gDoc = await db.collection("stats").doc("global").get();
    const uData = uDoc.exists ? uDoc.data() : { jaap: 0, write: 0 };
    document.getElementById('uJaap').innerText = uData.jaap || 0;
    document.getElementById('uWrite').innerText = uData.write || 0;
    document.getElementById('sJaap').innerText = session.jaap;
    document.getElementById('sWrite').innerText = session.write;
    document.getElementById('gTotal').innerText = gDoc.exists ? gDoc.data().count : 0;
  }

  auth.onAuthStateChanged(user => {
    if (user) {
      document.getElementById('authSection').style.display = 'none';
      document.getElementById('bankSection').style.display = 'block';
      updateDisplay(user.uid);
    }
  });

  function handleAuth() {
    const email = document.getElementById('email').value.trim();
    const pass = document.getElementById('password').value;
    if(isSignupMode) auth.createUserWithEmailAndPassword(email, pass).catch(e => alert(e.message));
    else auth.signInWithEmailAndPassword(email, pass).catch(e => alert(e.message));
  }
  function logout() { auth.signOut().then(() => location.reload()); }
  function forgotPassword() {
    const email = document.getElementById('email').value;
    if(!email) { alert("Enter email first"); return; }
    auth.sendPasswordResetEmail(email).then(() => alert("Reset link sent!"));
  }
</script>
</body>
</html>
