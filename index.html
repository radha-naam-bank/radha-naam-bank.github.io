<!DOCTYPE html>
<html>
<head>
  <title>Radha Naam Bank</title>
  <meta charset="UTF-8">
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <style>
    body { margin: 0; font-family: Georgia, serif; background: linear-gradient(to bottom, #fff5e1, #ffe4b5); text-align: center; }
    header { background: #800000; color: gold; padding: 20px; font-size: 28px; }
    button { padding: 15px 25px; background: #ff9933; border: none; font-size: 18px; margin: 15px; cursor: pointer; border-radius: 8px; color: white; font-weight: bold; }
    input { padding: 10px; margin: 5px; width: 250px; border-radius: 5px; border: 1px solid #ccc; }
    #dashboard { padding: 20px; }
    h2 { font-size: 50px; color: #800000; margin: 20px 0; }
  </style>
</head>
<body>

<header>ðŸŒ¸ Radha Naam Bank ðŸŒ¸</header>

<div id="login">
  <h3>Welcome, Devotee</h3>
  <input type="email" id="email" placeholder="Enter Email"><br>
  <input type="password" id="password" placeholder="Enter Password"><br>
  <button onclick="signup()">Signup</button>
  <button onclick="login()">Login</button>
</div>

<div id="dashboard" style="display:none;">
  <h2>à¤°à¤¾à¤§à¤¾</h2>
  <button onclick="writeRadha()">Write Radha</button>
  <h3>Your Count: <span id="userCount">0</span></h3>
  <h3>Global Count: <span id="globalCount">0</span></h3>
  <br>
  <button onclick="logout()" style="background: #333; font-size: 14px;">Logout</button>
</div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCjWR3iIF07Ohj22bjzv5QIPFKL55t1wB0",
    authDomain: "radha-naam-bank-abec4.firebaseapp.com",
    projectId: "radha-naam-bank-abec4",
    storageBucket: "radha-naam-bank-abec4.firebasestorage.app",
    messagingSenderId: "625272113751",
    appId: "1:625272113751:web:607d6c0544fbba4eb2f112"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();
  let currentUser;

  function signup() {
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    auth.createUserWithEmailAndPassword(email, password)
      .then(() => alert("Signup successful! Welcome to the Bank."))
      .catch(error => alert(error.message));
  }

  function login() {
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    auth.signInWithEmailAndPassword(email, password)
      .then(() => alert("Login successful!"))
      .catch(error => alert(error.message));
  }

  function logout() {
    auth.signOut().then(() => location.reload());
  }

  auth.onAuthStateChanged(user => {
    if (user) {
      currentUser = user;
      document.getElementById("login").style.display = "none";
      document.getElementById("dashboard").style.display = "block";
      loadCounts();
    }
  });

  async function writeRadha() {
    const userRef = db.collection("users").doc(currentUser.uid);
    const globalRef = db.collection("stats").doc("global");

    await db.runTransaction(async (transaction) => {
      const userDoc = await transaction.get(userRef);
      const globalDoc = await transaction.get(globalRef);
      let userCount = userDoc.exists ? userDoc.data().count : 0;
      let globalCount = globalDoc.exists ? globalDoc.data().count : 0;
      transaction.set(userRef, { count: userCount + 1 });
      transaction.set(globalRef, { count: globalCount + 1 });
    });
    loadCounts();
  }

  async function loadCounts() {
    const userDoc = await db.collection("users").doc(currentUser.uid).get();
    const globalDoc = await db.collection("stats").doc("global").get();
    document.getElementById("userCount").innerText = userDoc.exists ? userDoc.data().count : 0;
    document.getElementById("globalCount").innerText = globalDoc.exists ? globalDoc.data().count : 0;
  }
</script>
</body>
</html>
